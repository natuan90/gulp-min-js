!function(e,t){var a=skygate.util.format,i=Backbone.View.extend({initialize:function(e){this.template=_.template(t("#airSuggestionItem").html()),_.each(this.$el.find(".js-air-auto-complete"),function(a){this.setupAutoComplete(t(a),e.suggestion||{})},this)},setupAutoComplete:function(e,a){this._setupAirSuggest(t(e),a),this._renderItem(t(e))},_setupAutocomplete:function(e,t){t.disabled=!0,e.autocomplete(t),e.one("focus",function(){e.autocomplete("option","disabled",!1)})},_setupAirSuggest:function(e,a){var i=this;this._setupAutocomplete(t(e),{source:function(e,s){var n=t.trim(e.term);if(!(n.length<2)){var r=i._convertInput(n);return s(skygate.air.util.search(r,10,_.has(a,"searchDomestic")?a.searchDomestic:null,_.has(a,"exceptList")?a.exceptList:[]))}},autoFocus:!0,delay:0,select:function(e,a){var i=t(e.currentTarget).find(".ui-state-focus"),s=i.data("citycode"),n=i.data("suggestlabel"),r=t(this);return r.attr("data-cityCode",s),r.attr("data-suggestLabel",n),r.val(n),!1},appendTo:t(e).closest(".input-text-base").find(".sgt-dep"),position:{within:t(this).closest(".input-text-base").find(".sgt-dep")},open:function(e,a){var i=t(e.target).closest(".input-text-base").find(".js-city-suggest-modal");t(i).addClass("show").addClass("ui-autocomplete"),t(i).find("ul.ui-autocomplete").addClass("list-suggest-01"),t(i).find("ul.list-suggest-01").attr("style",""),t(i).find("ul.list-suggest-group").attr("style","");var s=t(e.target).closest(".input-text-base").find(".modal-city-popular");s&&t(s).is(":visible")&&s.hide(),t(e.target).closest(".input-text-base").find(".err-text-01").hide()},close:function(e,a){var i=t(e.target).closest(".input-text-base");t(i).find(".js-city-suggest-modal").removeClass("show")},response:function(e,a){t("span.ui-helper-hidden-accessible").addClass("none")}})},_renderItem:function(e){var a=this;t(e).data("ui-autocomplete")._renderItem=function(e,i){searchMask=a._convertInput(this.element.val());var s=a.createAutoSuggestionCityName(i.threeLetter,i.domesticThreeLetter,i.name,i.countryName,searchMask);i.value=s.cityCountryName;var n=[];_.isEmpty(i.children)||(n=_.map(i.children,function(e){return a.createAutoSuggestionCityName(e.threeLetter,e.domesticThreeLetter,e.name,e.countryName,searchMask)}));var r=a.template({item:s,children:n});return t(r).data("item.autocomplete",i),t(r).appendTo(e)}},createAutoSuggestionCityName:function(e,t,i,s,n){var r=t?a("（{0}, {1}）",e,t):a("（{0}）",e),o=a("{0}, {1}",i,s);return{cityCode:e,cityCountryName:o,cityCountryNameWithKeyword:a("{0}{1}",r,o).replace(new RegExp(n,"gm"),a("<b>{0}</b>",n))}},_removeSpecialCharacters:function(e){var t=e.match(/[\u3041-\u3096\u30A1-\u30FAa-zA-Z0-9\u3400-\u9FFF]/g);return _.isEmpty(t)?"":t.join("")},_convertHiraToKana:function(e){return e.replace(/[ぁ-ゔ]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)}).replace(/(ウ゛)/g,"ヴ").replace(/ゕ/g,"ヵ").replace(/ゖ/g,"ヶ")},_convertInput:function(e){var t=this._removeSpecialCharacters(e);return t?this._convertHiraToKana(t).toUpperCase():""},_escapeRegex:function(e,t){return(e+"").replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(t||"")+"-]","g"),"\\$&")}});skygate.util.namespace("airlink.view.ui_integration_multi_search_form.components").AirSuggestionView=i}(window,jQuery);