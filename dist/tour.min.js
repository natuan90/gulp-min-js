!function(t,e){var i=skygate.util.format,r=(skygate.util.date.computeDate,skygate.util.date.toYmdString),a=(skygate.util.date.ymdStringToObject,skygate.util.date.ymdStringToObjectWithSeparator,skygate.util.date.toYmString),s=skygate.view.pc.searchform.component._depDateBase,n=airlink.model.common.ui_integration_multi_search_form,o=n.MultiSearchFormBaseModel.extend(_.extend(s,{defaults:{domesticAirports:null,absoluteUmpList:null,popCities:null},setup:function(){var e=this.attributes;e.domesticAirports=t.domesticAirportListForTour||{},e.absoluteUmpList=t.ump_cities||[],e.popCities=t.pop_cities||{},e.areaCities={areas:[],city_map:{}},this._setupAreaCity()},_setupAreaCity:function(){var t=this;e.ajax({url:"/tour/get_city_code",type:"GET",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",data:{},success:function(e){var i={areas:_.clone(e.areas)||[],city_map:_.clone(e.city_map)||{}};t.set("areaCities",i)}})},validDate:function(t){if(!t)return!1;try{var e=t.split("/");if(3===e.length){var i=new Date(e[0],+e[1]-1,e[2]);return 4==(e[0]+"").length&&2==(e[1]+"").length&&2==(e[2]+"").length&&(null!=i&&i.getFullYear()==e[0]&&i.getMonth()+1==e[1]&&i.getDate()==e[2])}if(2===e.length){i=new Date(e[0],+e[1]-1);return 4==(e[0]+"").length&&2==(e[1]+"").length&&(null!=i&&i.getFullYear()==e[0]&&i.getMonth()+1==e[1])}return!1}catch(t){return!1}},validate:function(t){var e=[];if(t.cty&&_.isArray(t.cty)&&t.cty.length>0||e.push({cty:i(this.errorMessage.required,"目的地")}),t.from_date)if(this.validDate(t.from_date)){var s=r(this.dateStartsFrom()),n=_.clone(t.from_date).split("/").join("");if(6===n.length)n<a(new Date)&&e.push({fromDate:"出発日は明日以降の日付を指定してください。"});else 8===n.length&&n<s&&e.push({fromDate:"出発日は明日以降の日付を指定してください。"})}else e.push({fromDate:i(this.errorMessage.invalidDate,"出発日")});else e.push({fromDate:i(this.errorMessage.required,"出発日")});return e},isExistsInAbsoluteUmp:function(t){return!!_.find(this.get("absoluteUmpList"),function(e){return e.departure===t})},isSelectableCityByAbsoluteUmp:function(t,e){var i=_.find(this.get("absoluteUmpList"),function(e){return e.departure===t});return!!i&&!!_.find(i.arrive,function(t){return t===e})},getAvailableCityCodes:function(t){return _.find(this.get("absoluteUmpList"),function(e){return e.departure===t}).arrive},getPopularCity:function(t){if(t)e=_.has(this.get("popCities"),t)?this.get("popCities")[t]:this.get("popCities").DEFAULT;else var e=this.get("popCities").DEFAULT;return e},isDaySelectable:function(t){return!_.isEmpty(t)},eachSelectableDays:function(t,e){if(this.isDaySelectable(t))for(var i=+t.substring(0,4),r=+t.substring(4,6),a=this.dateStartsFrom(),s=a.getFullYear(),n=a.getMonth()+1,o=a.getDate(),u=new Date(i,r,0).getDate(),l=1;l<=u;l++)i==s&&r==n&&l<o||e(i,r,l)}}));n.TourFormModel=o}(window,jQuery);