!function(t,e){var i=Backbone.Model.extend({AIR_ITINERARY_TYPE:{ONE_WAY:0,ROUND_TRIP:1,MULTIPLE_DESTINATION:2},CROSS_SELL_TYPE:{SEL:"SEL1",TPE:"SEL1",HNL:"HNL1",DPS:"HNL1"},LIST_URL_FORMAT:"/hotel/list?{0}",DETAIL_URL_FORMAT:"/hotel/HTLITM/{0}/?{1}",FORM_NAME:"smartCrossSell",url:"/hotel/api/cs/list",idAttribute:"itineraryNumber",initialize:function(){_.each(["type","profile","encodedRooms","checkin","checkout","numberOfNights","queryParams","isApplicable","_firstArrivalDate","_secondDepartureDate"],function(t){this[t]=_.memoize(this[t])},this)},type:function(){return this.CROSS_SELL_TYPE[this.get("cityCode")]},profile:function(){var t=this.type(),e=this.get("seatClass"),i=this.get("numberOfPax");if("SEL1"===t){if("C"===e||"F"===e)return"PREMIUM";if("Y"===e||"P"===e)return i>=4?"LEISURE":"BUSINESS"}else if("HNL1"===t){if("C"===e||"F"===e)return"PREMIUM";if("Y"===e||"P"===e)return i>=2?"LEISURE":"BUSINESS"}},encodedRooms:function(){var t=this.get("numberOfPax"),e=this.get("numberOfInfants");return t<=3?t.toString():4===t?e>=1?"4":"2:2":5===t?"2:3":6===t?"3:3":7===t?"2:2:3":8===t?"2:2:2:2":9===t?"3:3:3":""},checkin:function(){return this.get("itineraryType")===this.AIR_ITINERARY_TYPE.ONE_WAY?this._firstArrivalDate():_.contains([this.AIR_ITINERARY_TYPE.ROUND_TRIP,this.AIR_ITINERARY_TYPE.MULTIPLE_DESTINATION],this.get("itineraryType"))&&this._firstArrivalDate()<this._secondDepartureDate()?this._firstArrivalDate():void 0},checkout:function(){return this.get("itineraryType")===this.AIR_ITINERARY_TYPE.ONE_WAY?skygate.util.date.toYmdString(skygate.util.date.computeDate(skygate.util.date.ymdStringToObject(this._firstArrivalDate()),1)):_.contains([this.AIR_ITINERARY_TYPE.ROUND_TRIP,this.AIR_ITINERARY_TYPE.MULTIPLE_DESTINATION],this.get("itineraryType"))&&this._firstArrivalDate()<this._secondDepartureDate()?this._secondDepartureDate():void 0},numberOfNights:function(){return skygate.util.date.diffDate(skygate.util.date.ymdStringToObject(this.checkout()),skygate.util.date.ymdStringToObject(this.checkin()))},queryParams:function(){return{checkin:this.checkin(),checkout:this.checkout(),ctyCd:this.get("cityCode"),seatClass:this.get("seatClass"),rooms:this.encodedRooms()}},isApplicable:function(t){if(!t&&!this.get("firstArrivalDateTime"))return!1;var e=(new Date).getTime()<=skygate.util.date.ymdhmStringToObject(this.get("startDate")).getTime(),i=this.get("itineraryType")===this.AIR_ITINERARY_TYPE.ONE_WAY||t&&this.get("startDate")<this.get("endDate")||!t&&this._firstArrivalDate()<this._secondDepartureDate();return e&&i&&!this.get("isOverseas")},fetchHotelData:function(){if(this.get("apiResponse"))_.defer(_.bind(this._triggerFetched,this));else if(!this.fetchRrequestFired){this.fetchRrequestFired=!0;var t=this;this.fetch({data:this.queryParams()}).fail(function(){t.set("apiResponse",{})}).always(function(){t._triggerFetched()})}},parse:function(t){return{apiResponse:t.result}},hotelListUrl:function(){var t=e.extend(!0,{},this.queryParams(),{form:this.FORM_NAME,AgentCode:this.get("agentCodeForList")});return skygate.util.format(this.LIST_URL_FORMAT,e.param(t,!0))},hotelDetailUrl:function(t){var i=e.extend(!0,{},this.queryParams(),{crossSellType:this.type(),profile:this.profile(),form:this.FORM_NAME,AgentCode:this.get("agentCodeForDetail")});return skygate.util.format(this.DETAIL_URL_FORMAT,t,e.param(i,!0))},_triggerFetched:function(){this.trigger("CrossSell:Fetched",this.get("itineraryNumber"))},_firstArrivalDate:function(){return this.get("firstArrivalDateTime").substring(0,8)},_secondDepartureDate:function(){return this.get("secondDepartureDateTime").substring(0,8)}}),r=Backbone.Collection.extend({model:i,applicableItems:function(t){return _.filter(this.models,function(e){return e.isApplicable(!!t)})}});skygate.util.namespace("airlink.model.hotel.crosssell").CrossSellModel=i,skygate.util.namespace("airlink.model.hotel.crosssell").CrossSellCollection=r}(window,jQuery);