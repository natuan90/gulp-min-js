!function(e,t){var i=skygate.util.format,r=skygate.util.date.computeDate,a=skygate.util.date.toYmdString,s=(skygate.util.date.ymdStringToObject,skygate.util.date.ymdStringToObjectWithSeparator),n=skygate.util.date.diffDate,o=airlink.model.common.ui_integration_multi_search_form,u={AUTO_COMPLETE_URL:"/hotel/api/auto_complete",suggest:function(e){return t.ajax(this.AUTO_COMPLETE_URL,{type:"get",dataType:"json",cache:!1,data:t.param({q:e,field:this._getAutoCompleteField()})})},roomSettingsToRooms:function(e){return _.reduce(e,function(e,t){var i=t.adultNum,r=t.minorAges;return r&&r.length>0?(r.unshift(i),e.push(r.join(","))):e.push(i),e},[]).join(":")}},c=o.MultiSearchFormBaseModel.extend({DEFAULT_INTERVAL:2,MIN_GRADE:1,MAX_GRADE:5,autoCompleteField:"region,landmark,airport,hotel",defaults:{checkin:null,checkout:null,stayNum:null},initialize:function(e){var t=r(new Date,1),i=r(t,this.DEFAULT_INTERVAL);this.set("checkin",t,{silent:!0}),this.set("checkout",i,{silent:!0}),this.setStayNum(!0)},getCheckinString:function(){return a(this.get("checkin"),"/")},getCheckoutString:function(){return a(this.get("checkout"),"/")},_getAutoCompleteField:function(){return this.autoCompleteField},setDate:function(e,t){var i=s(this.normalizeDateString(t));this.set(e,i);var a=this.get("checkout");"checkin"===e&&i>=a&&this.set("checkout",r(i,1)),this.setStayNum()},setStayNum:function(e){var t,i=this.get("checkin"),r=this.get("checkout");try{t=n(this.get("checkout"),this.get("checkin"))}catch(e){}i&&r&&_.isNumber(t)&&!(t<1)||(t="-"),this.set("stayNum",t,{silent:e})},validDate:function(e){if(!e)return!1;try{var t=e.split("/"),i=new Date(t[0],+t[1]-1,t[2]);return null!=i&&i.getFullYear()==t[0]&&i.getMonth()+1==t[1]&&i.getDate()==t[2]}catch(e){return!1}},validate:function(e){var t=[],a=!1,n=e.checkin,o=e.checkout,u=s(n),c=s(o);if(n&&o?this.validDate(n)&&this.validDate(o)||(this.validDate(n)||t.push({message:i(this.errorMessage.invalidDate,"チェックイン"),type:".error-checkin"}),this.validDate(o)||t.push({message:i(this.errorMessage.invalidDate,"チェックアウト"),type:".error-checkout"}),a=!0):(n||t.push({message:i(this.errorMessage.required,"チェックイン"),type:".error-checkin"}),o||t.push({message:i(this.errorMessage.required,"チェックアウト"),type:".error-checkout"}),a=!0),!a){var h=r(new Date,0);(h>u||h>c)&&(h>u&&t.push({message:"チェックインは今日以降の日付を指定してください。",type:".error-checkin"}),h>c&&t.push({message:"チェックアウトは今日以降の日付を指定してください。",type:".error-checkout"}),a=!0)}return a||u>c&&(t.push({message:"チェックイン・チェックアウトの指定が不正です。",type:".error-checkin"}),a=!0),t},createQueryParameter:function(e){var i=e.roomSettings,r=e.minGrade,a=e.maxGrade,s=e.facilities;delete e.roomSettings,delete e.minGrade,delete e.maxGrade,delete e.facilities,delete e.suggestLabel,e.rooms=this.roomSettingsToRooms(i);var n=t.param(e);if(r||a){var o;if(r&&a)if(r===a)o=[r];else{var u=a>r?r:a,c=a>r?a+1:r+1;o=_.range(u,c)}else o=_.range(r||this.MIN_GRADE,(a||this.MAX_GRADE)+1);n+=_.reduce(o,function(e,t){return e+="&grade="+t},"")}return s&&(n+=_.reduce(s,function(e,t){return e+="&facility="+t},"")),n}});_.extend(c.prototype,u),o.HotelFormModel=c,o.HotelFormModexMixin=u}(window,jQuery);