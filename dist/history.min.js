$(function(){"use strict";var e,t,n,a,r,o,i,s,c,l,m,u,h,d,f,g,p,b,y=$(document),L=function(e){var t=$(e).html()||"";return t=(t=t.split("\r\n").join("\n")).split("\r").join("\n"),_.map(t.split("\n"),function(e){return $.trim(e)}).join("")},D=[];n=(e=Backbone.Model.extend({_formatMoney:function(e){for(var t=(e+"").replace(/,/g,"");t!=(t=t.replace(/^(-?\d+)(\d{3})/,"$1,$2")););return t},_formatNoneLabel:function(e){return e||"指定なし"}})).extend({parse:function(e){return{lbl_icon:e.lbl_icon,link:"javascript:void(0)",clicklink:"/tour/detail?"+this._formatParams(e),cty:e.dest_city_name,airport:e.dep_city_name+"発",day:e.trip_days+"日間",ex:this._formatTourStartDate(e.tour_start_date),htl_name:"【ホテル】"+e.htl_name,carrier_name:"【航空会社】"+e.carrier_name,options:this._formatOptions(e),room_num:"【部屋】"+e.room_num+"部屋",pax_num:"【人数】"+this._formatPaxNum(e),adult_fee:this._formatMoney(e.adult_tour_fee-e.adult_discount_fee),baseLogParams:this._formatBaseLogParams(e),cty_code:e.dest_city_cd,picture_num:e.picture_num}},_formatParams:function(e){return _(["tourCd="+e.tour_cd,"flight="+e.air_seq_id,"hotelSeqId="+e.land_htl_seq_id,"pickup="+e.land_transfer_seq_id,"fromDate="+e.tour_start_date,"rooms="+encodeURIComponent(e.assignment_of_rooms),"option="+e.option_param]).join("&")},_formatTourStartDate:function(e){return _([e.length>=6?+e.substr(4,2)+"月":"指定なし",8===e.length?+e.substr(6,2)+"日":"指定なし"]).compact().join("")},_formatOptions:function(e){return _(["【送迎】",e.transfer_kind_name?e.transfer_kind_name:"指定なし"]).compact().join("")},_formatPaxNum:function(e){return _([parseInt(e.adult_num)>0?"大人"+e.adult_num+"名":"",parseInt(e.child_num)>0?"子供"+e.child_num+"名":"",parseInt(e.child_no_bed_num)>0?"ベッド利用なし子供"+e.child_no_bed_num+"名":"",parseInt(e.infant_num)>0?"幼児"+e.infant_num+"名":""]).compact().join("、")},_formatBaseLogParams:function(e){var t={};return t.item01=e.dest_city_cd,t.item02=e.dep_city_cd,t.item03=e.tour_cd,t}}),o=e.extend({parse:function(e){return{lbl_icon:e.lbl_icon,link:"javascript:void(0)",clicklink:"/tour/list?"+this._formatParams(e),cty:this._formatCity(e),airport:this._formatAirport(e),day:e.lbl_day,ex:e.lbl_ex,htl_name:"【ホテル】 "+this._formatNoneLabel(e.htl_name),htl_grade:"【ホテルグレード】 "+this._formatHtlGrade(e),carrier_name:"【航空会社】 "+this._formatNoneLabel(e.lbl_flt_carrier),options:this._formatOptions(e),pax_num:"【人数】 "+this._formatPaxNum(e),price:"【予算】 "+this._formatMoney(e),baseLogParams:this._formatBaseLogParams(e),cty_code:e.priority_cty_cd,picture_num:e.picture_num}},_formatParams:function(e){return _.chain(["from_date","dep","area","cty","min_date","max_date","min_price","max_price","number_room","travelers","tour_tags","min_htl_gd","max_htl_gd","htl_area","htl_cd","htl_chr","rom_chr","flt_carrier","flt_class","flt_time_go","flt_time_rtn","flt_chr","trf_type","opt"]).map(function(t){return t+"="+encodeURIComponent(decodeURIComponent(e[t]))}).join("&").value()},_formatAirport:function(e){var t=e.lbl_dep.split("（");return(t.length>1?t[0]:e.lbl_dep)+"発"},_formatCity:function(e){return e.lbl_cty||e.lbl_area?e.lbl_cty.split(",").length>0?e.lbl_cty:e.lbl_area:""},_formatOptions:function(e){return _(["【往路】",e.lbl_flt_time_go?e.lbl_flt_time_go:"指定なし","　","【復路】",e.lbl_flt_time_rtn?e.lbl_flt_time_rtn:"指定なし"]).compact().join("")},_formatPaxNum:function(e){return _([parseInt(e.adult_num)>0?"大人"+e.adult_num+"名":"",parseInt(e.child_num)>0?"子供"+e.child_num+"名":"",parseInt(e.child_no_bed_num)>0?"ベッド利用なし子供"+e.child_no_bed_num+"名":"",parseInt(e.infant_num)>0?"幼児"+e.infant_num+"名":""]).compact().join("、")},_formatHtlGrade:function(e){return parseInt(e.min_htl_gd)>0||parseInt(e.max_htl_gd)>0?_([parseInt(e.min_htl_gd)>0?"★★★★★".slice(-1*e.min_htl_gd):"指定なし","～",parseInt(e.max_htl_gd)>0?"★★★★★".slice(-1*e.max_htl_gd):"指定なし"]).compact().join(""):"指定なし"},_formatMoney:function(e){return _([parseInt(e.min_price)>0?this._formatMoney(e.min_price)+"円":"指定なし","～",parseInt(e.max_price)>0?this._formatMoney(e.max_price)+"円":"指定なし"]).compact().join("")},_formatBaseLogParams:function(e){var t={},n=e.cty.split(",");return e.cty?t.item01=n.length>1?_.sortBy(n,function(e){return e.charCodeAt()}).join("_"):e.cty:t.item01=e.area,t.item02=e.dep,t}}),a=Backbone.Collection.extend({url:"/tour/history/get_tour_history_list?num=3",model:n,parse:function(e){return e.tour_history_list}}),i=Backbone.Collection.extend({url:"/common/history/get_abtour_auto_history_search",model:o,parse:function(e){return e.history_list}}),r=(t=Backbone.View.extend({_formatLongString:function(e,t,n){return e.length>t?e.substring(0,t-1)+n:e},_hasElements:function(e){return _.any(e,function(e){return e.size()})},_sendLog:function(e,t){if(window.baselog&&e){var n=$.extend(!0,{},t,{event:e},{dispId:window.baselog.params.dispId,dispPath:window.baselog.params.dispPath,referer:window.baselog.params.referer});window.baselog.params=n,window.baselog.submit(e)}},_getPicturePath:function(e,t){if(e&&t||(e="xxx",t=10),t&&t>0){_.random(0,t-1);return["//s.skygate.co.jp","/images/recommend_auto/",e.toLowerCase(),"/",e.toLowerCase(),"_",this._getFileNumber(e.toLowerCase(),t),".jpg"].join("")}return"//s.skygate.co.jp/images/common/noimage_op.jpg"},_delegateDefaultImageLoading:function(e){var t=!1,n=this;e.load(function(){$(this).show()}).error(function(){if(!t){var e=n._getPicturePath();$(this).attr("src",e).show(),t=!0}})},_getFileNumber:function(e,t){var n,a=[];return(a=_.filter(D,function(t){return-1!==t.indexOf(e)})).length>=t&&(D=_.reject(D,function(t){return-1!==t.indexOf(e)}),a=_.range(0)),a=_.map(a,function(e){return Number(e.substr(e.length-2,2))}),n=("0"+_.first(_.shuffle(_.difference(_.range(t),a)))).slice(-2),D.push(e+n),n},_formatBaseLogParamsAGCD:function(e,t){return $.extend(!0,{},e,{item04:t})},_showDefaultCommon:function(e,t){var n=$(e),a=n.attr("historyDefaultLoad")||n.attr("data-history-default-load");a||n.remove(),n.hasClass("recommendBox")&&(n.removeClass("recommendBox"),n.addClass("bannerBox"));var r=this;$.ajax({url:a,dataType:"text",success:function(e){var a=e.replace(/<SCRIPT.*<\/SCRIPT>/g,"");n.html(a),r._sendLog(t,r._formatBaseLogParamsAGCD({},n.attr("historyAgentCode")||n.attr("data-history-agent-code")))},error:function(){n.remove()}})}})).extend({initialize:function(){var e=this._getElements();if(this._hasElements(e)){var t=this,n={cache:!1,timeout:1e4,success:function(){t.render()},error:function(){t._showDefaults(t._getElements())}},a=Backbone.ajax;Backbone.ajax=function(e){var t=e.success,n=e.error;delete e.success,delete e.error;var a=skygate.util.callAuthApi(e);return t&&a.done(t),n&&a.fail(n),a},this.collection.fetch(n),Backbone.ajax=a}},render:function(){var e,t,n,a,r,o;if(e=this,t=this.collection.models,(r=this._getElements()).length>0)for(o=0;o<r.length;o++)a=r[o],t[o]&&a.length>0?((n=t[o].toJSON()).clicklink=n.clicklink+"&AgentCode="+a.attr("historyAgentCode"),n.img=this._getPicturePath(n.cty_code,n.picture_num),a.html(_.template(L("#historyAbtourDetailTemplate"),n)),e._delegateDefaultImageLoading(a.find(".targetImage")),n.baseLogParams=this._formatBaseLogParamsAGCD(n.baseLogParams,a.attr("historyAgentCode")),this._sendLoadLog(n.baseLogParams),function(t,n,a){t.click(function(){setTimeout(function(){window.location.href=a},200);var t="UMP_item_"+n.item01;ga("send","event","recommend","click",t),e._sendClickLog(n)})}(a,n.baseLogParams,n.clicklink)):a.length>0&&this._showDefault(a)},_getElements:function(){return _([$("#historyAbtourDetail1"),$("#historyAbtourDetail2"),$("#historyAbtourDetail3")]).compact()},_showDefaults:function(e){var t;if(e.length>0)for(t=0;t<e.length;t++)e[t].length>0&&this._showDefault(e[t])},_showDefault:function(e){this._showDefaultCommon(e,"RECOMMEND_DETAIL_ABTOUR_LOAD")},_sendLoadLog:function(e){this._sendLog("RECOMMEND_DETAIL_ABTOUR_LOAD",e)},_sendClickLog:function(e){this._sendLog("RECOMMEND_DETAIL_ABTOUR_CLICK",e)}}),s=t.extend({initialize:function(){var e=this._getElements();if(this._hasElements(e)){var t=this,n=Backbone.ajax,a={cache:!1,timeout:1e4,success:function(){t.render()},error:function(){t._showDefaults(t._getElements())}};Backbone.ajax=function(e){var t=e.success,n=e.error;delete e.success,delete e.error;var a=skygate.util.callAuthApi(e);return t&&a.done(t),n&&a.fail(n),a},this.collection.fetch(a),Backbone.ajax=n}},render:function(){var e,t,n,a,r,o;if(e=this,t=this.collection.models,(r=this._getElements()).length>0)for(o=0;o<r.length;o++)a=r[o],t[o]&&a.length>0?((n=t[o].toJSON()).clicklink=n.clicklink+"&AgentCode="+a.attr("historyAgentCode"),n.img=this._getPicturePath(n.cty_code,n.picture_num),a.html(_.template(L("#historyAbtourSearchTemplate"),n)),e._delegateDefaultImageLoading(a.find(".targetImage")),n.baseLogParams=this._formatBaseLogParamsAGCD(n.baseLogParams,a.attr("historyAgentCode")),this._sendLoadLog(n.baseLogParams),function(t,n,a){t.click(function(){setTimeout(function(){window.location.href=a},200);var t="UMP_search_"+n.item01;ga("send","event","recommend","click",t),e._sendClickLog(n)})}(a,n.baseLogParams,n.clicklink)):a.length>0&&this._showDefault(a)},_getElements:function(){return _([$("#historyAbtourSearch1"),$("#historyAbtourSearch2"),$("#historyAbtourSearch3")]).compact()},_showDefaults:function(e){var t;if(e.length>0)for(t=0;t<e.length;t++)e[t].length>0&&this._showDefault(e[t])},_showDefault:function(e){this._showDefaultCommon(e,"RECOMMEND_SEARCH_ABTOUR_LOAD")},_sendLoadLog:function(e){this._sendLog("RECOMMEND_SEARCH_ABTOUR_LOAD",e)},_sendClickLog:function(e){this._sendLog("RECOMMEND_SEARCH_ABTOUR_CLICK",e)}}),c=e.extend({parse:function(e){var t,n;"0"==e.lbl_search_kind.substr(0,1)?(t="【航空会社】 "+e.lbl_carriers,n="【出発時間帯】 "+e.lbl_dep_time):"1"==e.lbl_search_kind.substr(0,1)&&(t="【座席クラス】 "+e.lbl_seat_class,n="【直行・経由】 "+e.lbl_direct);var a={searchKind:e.searchKind,fromDate:e.fromDate,toDates:e.toDates,departure:e.departure,destinations:e.destinations,arrival:e.arrival,adultNum:e.adultNum,minorAges:e.minorAges,only_pex_flg:"",seat_check_flg:"",direct:e.direct,openFix:e.openFix,carriers:e.carriers,omitLcc:e.omitLcc,seatClass:e.seatClass,depTimes:e.depTimes,lbl_icon:e.lbl_icon,lbl_search_kind_alt:e.lbl_search_kind_alt,lbl_search_kind_pic:"/recommend/images/"+e.lbl_search_kind_picture+".png",lbl_dep_day:"【出発日】 "+e.lbl_dep_day,lbl_dest_dep_day:_.isEmpty(e.lbl_dest_dep_day)?"":"【現地出発日】 "+e.lbl_dest_dep_day,lbl_pax_num:"【人数】 "+e.lbl_person_num,lbl_detail1:t,lbl_detail2:n,lbl_cty_code:e.priority_cty_cd,lbl_picture_num:e.picture_num,baseLogParams:this._formatBaseLogParams(e),lbl_departure:e.lbl_departure,lbl_destinations:e.lbl_destinations};return e.departure!==e.arrival?a.lbl_cty=e.lbl_departure+e.lbl_arrow+e.lbl_destinations+e.lbl_arrival:a.lbl_cty=e.lbl_departure+e.lbl_arrow+e.lbl_destinations,a},_formatBaseLogParams:function(e){var t={};return t.item01=e.destinations?e.destinations:"",t.item02=e.departure?e.departure:"",t}}),l=Backbone.Collection.extend({url:"/common/history/get_air_auto_history_search",model:c,parse:function(e){return e.history_list}}),m=t.extend({EVENT_HISTORY_RENDER_COMPLETED:"history:abroad_air:renderCompleted",initialize:function(){var e=this._getElements();if(this._hasElements(e)){var t=this;this.collection.fetch({cache:!1,timeout:1e4,success:function(){t.render(),y.trigger(t.EVENT_HISTORY_RENDER_COMPLETED,t.collection.models.length)},error:function(){t._showDefaults(t._getElements()),y.trigger(t.EVENT_HISTORY_RENDER_COMPLETED,0)}})}},render:function(){var e,t,n,a,r,o;if(e=this,t=this.collection.models,(r=this._getElements()).length>0)for(o=0;o<r.length;o++)a=r[o],t[o]&&a.length>0?((n=t[o].toJSON()).AgentCode=a.attr("historyAgentCode"),n.img=this._getPicturePath(n.lbl_cty_code,n.lbl_picture_num),n.parameters=this._convertQueryParameters(n),a.html(_.template(L("#historyAirSearchTemplate"),n)),e._delegateDefaultImageLoading(a.find(".targetImage")),n.baseLogParams=this._formatBaseLogParamsAGCD(n.baseLogParams,a.attr("historyAgentCode")),this._sendLoadLog(n.baseLogParams),function(t,n){t.click(function(){e._sendClickLog(n),$(this).delay(200).queue(function(){location.href=$(this).find("input[name=airSearch]").val(),$(this).dequeue()})})}(a,n.baseLogParams)):a.length>0&&this._showDefault(a)},_convertQueryParameters:function(e){var t=_.pick(e,"searchKind","fromDate","toDates","departure","destinations","arrival","adultNum","minorAges","direct","openFix","carriers","omitLcc","seatClass","depTimes","AgentCode");return function(e,t){var n=t||",",a=_.reduce(_.keys(e),function(e,t){return _.isArray(e[t])&&(e[t]=e[t].join(n)),e},$.extend(!0,{},e));return $.param(a)}(_.reduce(t,function(e,t,n){return t&&(e[n]=t),e},{}))},_getElements:function(){return _([$("#historyAirSearch1"),$("#historyAirSearch2"),$("#historyAirSearch3")]).compact()},_showDefaults:function(e){var t;if(e.length>0)for(t=0;t<e.length;t++)e[t].length>0&&this._showDefault(e[t])},_showDefault:function(e){this._showDefaultCommon(e,"RECOMMEND_SEARCH_AIR_LOAD")},_sendLoadLog:function(e){this._sendLog("RECOMMEND_SEARCH_AIR_LOAD",e)},_sendClickLog:function(e){this._sendLog("RECOMMEND_SEARCH_AIR_CLICK",e)}}),h=(u=e.extend({_ymdToDateObject:function(e){return new Date(parseInt(e.substring(0,4),10),parseInt(e.substring(4,6),10)-1,parseInt(e.substring(6,8),10))},_dateObjectToYmd:function(e){return("0000"+e.getFullYear()).slice(-4)+("00"+(e.getMonth()+1)).slice(-2)+("00"+e.getDate()).slice(-2)},_getNumberOfStay:function(e){if(!e.checkin||!e.checkout)return 0;if(e.number_of_stay)return e.number_of_stay;var t=this._ymdToDateObject(e.checkin),n=this._ymdToDateObject(e.checkout);return Math.floor((n.getTime()-t.getTime())/864e5)},_getCommonParams:function(e){var t={};if(e.checkin&&e.checkout){var n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=this._ymdToDateObject(e.checkin);if(a.getTime()>r.getTime()){var o=this._ymdToDateObject(e.checkout),i=e.number_of_stay||Math.floor((o.getTime()-r.getTime())/864e5);r=new Date(a.getFullYear(),a.getMonth(),a.getDate()+7);o=new Date(r.getFullYear(),r.getMonth(),r.getDate()+i);t.checkin=this._dateObjectToYmd(r),t.checkout=this._dateObjectToYmd(o)}else t.checkin=e.checkin,t.checkout=e.checkout}return _.isEmpty(e.rooms)||(t.rooms=this._decodeRooms(e.rooms)),t},_decodeRooms:function(e){var t=[];return _.each(e,function(e){var n=[];n.push(e.adult),_.each(e.childAges,function(e){n.push(e)}),t.push(n.join(","))}),t.join(":")}})).extend({parse:function(e){var t=e.value,n={hotelName:t.label_name_jp||t.label_name_en,img:t.image_path||"",area:t.label_region_jp||t.label_region_en,hotelCode:t.hotel_code,commonQuery:$.param(this._getCommonParams(t),!0),baseLogParams:this._formatBaseLogParams(t),cityCode:t.city_code,cityName:t.city_name,pictureNum:t.picture_num};return t.checkin&&t.checkout&&(n.checkinMonth=parseInt(t.checkin.substring(4,6),10),n.checkinDate=parseInt(t.checkin.substring(6,8),10),n.numberOfStay=this._getNumberOfStay(t),n.formattedPrice=t.price&&t.price.average&&this._formatMoney(t.price.average)||""),n},getDetailUrl:function(e){var t=this.get("commonQuery"),n="/hotel/HTLITM/"+this.get("hotelCode")+"/?";return n+=t?t+"&AgentCode="+e:"AgentCode="+e},_formatBaseLogParams:function(e){return{item01:e.city_code||e.region_id,item03:e.hotel_code}}}),g=u.extend({parse:function(e){var t=e.value,n={regionId:t.region_id,regionName:t.region_name,commonQuery:$.param($.extend(this._getCommonParams(t),this._getFilterParams(t)),!0),baseLogParams:this._formatBaseLogParams(t),cityCode:t.city_code,cityName:t.city_name,pictureNum:t.picture_num};if(t.checkin&&t.checkout)n.checkinMonth=parseInt(t.checkin.substring(4,6),10),n.checkinDate=parseInt(t.checkin.substring(6,8),10),n.numberOfStay=t.number_of_stay,_.isEmpty(t.grade)||(n.minGrade=_.min(t.grade),n.maxGrade=_.max(t.grade));else{var a=this._countPeople(t.rooms);n.adultNum=a.adults,n.childNum=a.children}return n},getListUrl:function(e){var t=this.get("commonQuery"),n="/hotel/LIST/"+this.get("regionId")+"/?";return n+=t?t+"&AgentCode="+e:"AgentCode="+e},_getFilterParams:function(e){var t={},n=_.union(e.filter_area||[],e.filter_landmark||[]);return _.isEmpty(n)||(t.filterRegionId=n),e.hotel_name&&(t.hotelName=e.hotel_name),_.isEmpty(e.grade)||(t.grade=e.grade),_.isEmpty(e.facility)||(t.facility=e.facility),e.min_price&&(t.minPrice=e.min_price),e.max_price&&(t.maxPrice=e.max_price),t},_countPeople:function(e){var t=0,n=0;return _.each(e,function(e){t+=e.adult,n+=_.size(e.childAges)}),{adults:t,children:n}},_formatBaseLogParams:function(e){return{item01:e.city_code||e.region_id}}}),d=Backbone.Collection.extend({model:h,parse:function(e){return e.result.result_list}}),p=Backbone.Collection.extend({model:g,parse:function(e){return e.result.result_list}}),f=t.extend({initialize:function(){if(this.$elements=this._getElements(),this._hasElements(this.$elements)){this.historyAbhotelDetailTemplate=_.template(L("#historyAbhotelDetailTemplate"));var e=this;this.collection.url="/hotel/bookmarks/get_abhotel_history_list?num="+this.$elements.length,this.collection.fetch({cache:!1,timeout:1e4,success:function(){e.render()},error:function(){e._showDefaults()}})}},render:function(){var e=this.collection.models,t=this;_.each(this.$elements,function(n,a){if(e[a]&&n.size()){var r=e[a].toJSON();r.img||(r.img=t._getPicturePath(r.cityCode,r.pictureNum));var o=t.historyAbhotelDetailTemplate({param:r});n.html(o);var i=n.find(".targetImage");t._delegateDefaultImageLoading(i),i.load($.proxy(t._fitHotelImage));var s=n.attr("data-history-agent-code");r.baseLogParams=t._formatBaseLogParamsAGCD(r.baseLogParams,s),t._sendLoadLog(r.baseLogParams);var c=e[a].getDetailUrl(s);n.find(".targetLink").click(function(e){_.delay(function(){window.location.href=c},200);var n="HO_item_"+r.baseLogParams.item01;ga("send","event","recommend","click",n),t._sendClickLog(r.baseLogParams)})}else n.length>0&&t._showDefault(n)})},_fitHotelImage:function(e){var t=$(e.currentTarget),n=t.attr("data-width"),a=t.attr("data-height"),r=n,o=a;if(r*a>o*n){var i=n/r;r=n,o*=i}else if(r*a<o*n){i=a/o;o=a,r*=i,t.css("padding-left",(n-r)/2)}t.attr({width:r,height:o}).show()},_getElements:function(){return _.reduce([$("#historyAbhotelDetail1"),$("#historyAbhotelDetail2"),$("#historyAbhotelDetail3")],function(e,t){return t.size()&&e.push(t),e},[])},_showDefaults:function(){var e=this;_.each(this.$elements,function(t){t.size()&&e._showDefault(t)})},_showDefault:function(e){this._showDefaultCommon(e,"RECOMMEND_DETAIL_ABHOTEL_LOAD")},_sendLoadLog:function(e){this._sendLog("RECOMMEND_DETAIL_ABHOTEL_LOAD",e)},_sendClickLog:function(e){this._sendLog("RECOMMEND_DETAIL_ABHOTEL_CLICK",e)}}),b=t.extend({initialize:function(){if(this.$elements=this._getElements(),this._hasElements(this.$elements)){this.historyAbhotelSearchTemplate=_.template(L("#historyAbhotelSearchTemplate"));var e=this;this.collection.url="/hotel/bookmarks/get_abhotel_auto_history_search?num="+this.$elements.length,this.collection.fetch({cache:!1,timeout:1e4,success:function(){e.render()},error:function(){e._showDefaults()}})}},render:function(){var e=this.collection.models,t=this;_.each(this.$elements,function(n,a){if(e[a]&&n.length>0){var r=e[a].toJSON();r.img=t._getPicturePath(r.cityCode,r.pictureNum);var o=t.historyAbhotelSearchTemplate({param:r});n.html(o),t._delegateDefaultImageLoading(n.find(".targetImage"));var i=n.attr("data-history-agent-code");r.baseLogParams=t._formatBaseLogParamsAGCD(r.baseLogParams,i),t._sendLoadLog(r.baseLogParams);var s=e[a].getListUrl(i);n.find(".targetLink").click(function(e){_.delay(function(){window.location.href=s},200);var n="HO_search_"+r.baseLogParams.item01;ga("send","event","recommend","click",n),t._sendClickLog(r.baseLogParams)})}else n.length>0&&t._showDefault(n)})},_getElements:function(){return _.reduce([$("#historyAbhotelSearch1"),$("#historyAbhotelSearch2"),$("#historyAbhotelSearch3")],function(e,t){return t.size()&&e.push(t),e},[])},_showDefaults:function(){var e=this;_.each(this.$elements,function(t){t.size()&&e._showDefault(t)})},_showDefault:function(e){this._showDefaultCommon(e,"RECOMMEND_SEARCH_ABHOTEL_LOAD")},_sendLoadLog:function(e){this._sendLog("RECOMMEND_SEARCH_ABHOTEL_LOAD",e)},_sendClickLog:function(e){this._sendLog("RECOMMEND_SEARCH_ABHOTEL_CLICK",e)}}),new r({collection:new a}),new s({collection:new i}),new m({collection:new l}),new f({collection:new d}),new b({collection:new p}),y.on("authentication:postLogout",function(){location.reload(!0)})});